import org.yaml.snakeyaml.Yaml;

import java.io.FileInputStream;
import java.io.InputStream;
import java.util.List;
import java.util.Map;
import java.util.Set;

public class EventRoutingConfigUtil {

    public static EventRoutingConfig readyYml() {
        try {
            // Load the entire YAML file into a Map
            Yaml yaml = new Yaml();
            InputStream inputStream = new FileInputStream("src/test/resources/application-test.yml");
            Map<String, Object> yamlMap = yaml.load(inputStream);

            // Initialize EventRoutingConfig
            EventRoutingConfig config = new EventRoutingConfig();

            // Extract and set the 'origins' map
            Map<String, String> origins = (Map<String, String>) ((Map<String, Object>) yamlMap.get("event-routing")).get("origins");
            config.setOrigins(origins);

            // Extract and set 'destinationCopybookToRoutingMap'
            Map<String, String> destinationCopybookToRoutingMap = (Map<String, String>) ((Map<String, Object>) yamlMap.get("event-routing")).get("destination-copybook-to-routing-map");
            config.setDestinationCopybookToRoutingMap(destinationCopybookToRoutingMap);

            // Extract and set 'destinationRoutingKeyMap'
            Map<String, List<Destination>> destinationRoutingKeyMap = (Map<String, List<Destination>>) ((Map<String, Object>) yamlMap.get("event-routing")).get("destination-routingKey-map");
            config.setDestinationRoutingKeyMap(destinationRoutingKeyMap);

            // Extract and set 'originPopulateCopybook'
            Map<String, List<String>> originPopulateCopybook = (Map<String, List<String>>) ((Map<String, Object>) yamlMap.get("event-routing")).get("originPopulateCopybook");
            config.setOriginPopulateCopybook(originPopulateCopybook);

            // Extract and set 'filterCopybookByPublisher'
            Map<String, Set<String>> filterCopybookByPublisher = (Map<String, Set<String>>) ((Map<String, Object>) yamlMap.get("event-routing")).get("filter-copybook-by-publisher");
            config.setFilterCopybookByPublisher(filterCopybookByPublisher);

            // Debug output to verify the extracted data
            System.out.println("Loaded Event Routing Config: " + config);

            return config;
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }
}